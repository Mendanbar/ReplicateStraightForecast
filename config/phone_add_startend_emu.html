<!DOCTYPE HTML>
<!DOCTYPE html PUBLIC "" "">

<HTML>

<HEAD>

<META content="IE=11.0000" http-equiv="X-UA-Compatible">

     <TITLE>Weather Face Configuration</TITLE>

<META charset="utf-8">     
<META name="viewport" content="width=device-width, initial-scale=1">
<LINK href="WeatherFaceConfiguration.files/jquery.mobile.min.css" rel="stylesheet"> 

<STYLE> #apikey { display: none;} </STYLE>

<SCRIPT src="WeatherFaceConfiguration.files/jquery.min.js"></SCRIPT>

<SCRIPT src="WeatherFaceConfiguration.files/jquery.mobile.min.js"></SCRIPT>

</HEAD> 

<BODY>
	<DIV id="main" data-role="page">
		<DIV class="ui-body ui-body-a" data-role="content">

			<p>This config page is for EMULATOR.</p>

			<DIV data-role="fieldcontain">
				<FIELDSET data-role="controlgroup" data-mini="true">
					<LEGEND>Weather Provider:</LEGEND>
					<INPUT name="weather-service" class="custom" id="radioyahoo"   type="radio" value="yahoo">
						<LABEL for="radioyahoo">YAHOO! Weather</LABEL>
					<INPUT name="weather-service" class="custom" id="radioopen"    type="radio" value="open">
						<LABEL for="radioopen">Open Weather Map</LABEL>
					<INPUT name="weather-service" class="custom" id="radiowundr"  type="radio" value="wundr">
						<LABEL for="radiowundr">Weather Undergroundp (API KEY required)</LABEL>
				</FIELDSET>
			</DIV>

			<DIV data-role="fieldcontain">
				<FIELDSET data-role="controlgroup" data-mini="true">
					<LEGEND>Background color:</LEGEND>
					<INPUT name="bg-color" class="custom" id="radioduke"   type="radio" value="duke">
						<LABEL for="radioduke">Duke Blue</LABEL>
					<INPUT name="bg-color" class="custom" id="radioblack"    type="radio" value="black">
						<LABEL for="radioblack">Black</LABEL>
					<INPUT name="bg-color" class="custom" id="radiored"  type="radio" value="red">
						<LABEL for="radiored">Red</LABEL>
				</FIELDSET>
			</DIV>

			<DIV data-role="fieldcontain">
				<LABEL for="fliphourly">Hourly Weather (requires key):</LABEL>
				<SELECT name="fliphourly" id="fliphourly" data-role="slider" data-mini="true">
					<OPTION value="off">Off</OPTION>
					<OPTION value="on">On</OPTION>
				</SELECT>
			</DIV>

			<DIV class="ui-content" id="popupCloseRight" data-role="popup">
				<A class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right" 
					href="http://ktagjp.github.io/WeatherFace/config/#" data-rel="back">Close</A>

				<P>Hourly weather requires a Weather Underground API key.</P>
				<P>Weather Underground provides a free Developer API key, but you must first sign up.
					You can <A href="http://www.wunderground.com/weather/api/">sign up here.</A></P>
			</DIV>

			<DIV id="apikey" data-role="fieldcontain" data-mini="true">
				<DIV class="ui-field-contain">
					<LABEL for="text-apikey">Weather Underground API Key:</LABEL>
					<INPUT name="text-apikey" id="text-apikey" type="text" autocomplete="off" autocorrect="off" autocapitalize="off"> 
				</DIV>
			</DIV>

			<DIV data-role="fieldcontain">
				<FIELDSET data-role="controlgroup" data-mini="true" data-type="horizontal">
					<LEGEND>Temperature Scale:</LEGEND>                 
					<INPUT name="weather-scale" class="custom" id="radioF" type="radio" value="F">   
             		<LABEL for="radioF">°Fahrenheit</LABEL>
					<INPUT name="weather-scale" class="custom" id="radioC" type="radio" value="C">          
					<LABEL for="radioC">°Celsius</LABEL>
				</FIELDSET>
			</DIV>

			<DIV data-role="fieldcontain">
				<LABEL for="flipbattery">Display Battery:</LABEL>  
				<SELECT name="flipbattery" id="flipbattery" data-role="slider" data-mini="true">
					<OPTION value="off">Off</OPTION>
					<OPTION value="on">On</OPTION>
				</SELECT>
			</DIV>

			<DIV data-role="fieldcontain">
				<LABEL for="flipbluetooth">Bluetooth Connection Alert:</LABEL>  
				<SELECT name="flipbluetooth" id="flipbluetooth" data-role="slider" data-mini="true">
					<OPTION value="off">Off</OPTION>
					<OPTION value="on">On</OPTION>
				</SELECT>
			</DIV>

			<DIV data-role="fieldcontain">
				<LABEL for="fliptimesignal">Hourly Vibration:</LABEL>  
				<SELECT name="fliptimesignal" id="fliptimesignal" data-role="slider" data-mini="true">
					<OPTION value="off">Off</OPTION>
					<OPTION value="on">On</OPTION>
				</SELECT>
			</DIV>

			<DIV data-role="fieldcontain">
				<LABEL for="vibstart">Start of Vibration:</LABEL>
				<SELECT name="vibstart" id="vibstart" data-mini="true">
					<OPTION value="0">AM 0:00</OPTION>
					<OPTION value="1">AM 1:00</OPTION>
					<OPTION value="2">AM 2:00</OPTION>
					<OPTION value="3">AM 3:00</OPTION>
					<OPTION value="4">AM 4:00</OPTION>
					<OPTION value="5">AM 5:00</OPTION>
					<OPTION value="6">AM 6:00</OPTION>
					<OPTION value="7">AM 7:00</OPTION>
					<OPTION value="8">AM 8:00</OPTION>
					<OPTION value="9">AM 9:00</OPTION>
					<OPTION value="10">AM 10:00</OPTION>
					<OPTION value="11">AM 11:00</OPTION>
					<OPTION value="12">PM 0:00</OPTION>
					<OPTION value="13">PM 1:00</OPTION>
					<OPTION value="14">PM 2:00</OPTION>
					<OPTION value="15">PM 3:00</OPTION>
					<OPTION value="16">PM 4:00</OPTION>
					<OPTION value="17">PM 5:00</OPTION>
					<OPTION value="18">PM 6:00</OPTION>
					<OPTION value="19">PM 7:00</OPTION>
					<OPTION value="20">PM 8:00</OPTION>
					<OPTION value="21">PM 9:00</OPTION>
					<OPTION value="22">PM 10:00</OPTION>
					<OPTION value="23">PM 11:00</OPTION>
				</SELECT>
			</DIV>

			<DIV data-role="fieldcontain">
				<LABEL for="vibend">End of Vibration:</LABEL>
				<SELECT name="vibend" id="vibend" data-mini="true">
					<OPTION value="0">AM 0:00</OPTION>
					<OPTION value="1">AM 1:00</OPTION>
					<OPTION value="2">AM 2:00</OPTION>
					<OPTION value="3">AM 3:00</OPTION>
					<OPTION value="4">AM 4:00</OPTION>
					<OPTION value="5">AM 5:00</OPTION>
					<OPTION value="6">AM 6:00</OPTION>
					<OPTION value="7">AM 7:00</OPTION>
					<OPTION value="8">AM 8:00</OPTION>
					<OPTION value="9">AM 9:00</OPTION>
					<OPTION value="10">AM 10:00</OPTION>
					<OPTION value="11">AM 11:00</OPTION>
					<OPTION value="12">PM 0:00</OPTION>
					<OPTION value="13">PM 1:00</OPTION>
					<OPTION value="14">PM 2:00</OPTION>
					<OPTION value="15">PM 3:00</OPTION>
					<OPTION value="16">PM 4:00</OPTION>
					<OPTION value="17">PM 5:00</OPTION>
					<OPTION value="18">PM 6:00</OPTION>
					<OPTION value="19">PM 7:00</OPTION>
					<OPTION value="20">PM 8:00</OPTION>
					<OPTION value="21">PM 9:00</OPTION>
					<OPTION value="22">PM 10:00</OPTION>
					<OPTION value="23">PM 11:00</OPTION>
				</SELECT>
			</DIV>

			<DIV data-role="fieldcontain">
				<LABEL for="flipdebug">Debug Mode:</LABEL>
			    <SELECT name="flipdebug" id="flipdebug" data-role="slider" data-mini="true">
					<OPTION value="off">Off</OPTION>
					<OPTION value="on">On</OPTION>
				</SELECT>
			</DIV>

			<FIELDSET class="ui-grid-a">
				<DIV class="ui-block-a">
					<BUTTON id="b-cancel" type="submit" data-theme="d">Cancel</BUTTON>
				</DIV>

				<DIV class="ui-block-b">
					<BUTTON id="b-submit" type="submit" data-theme="b">Save</BUTTON>
				</DIV>
			</FIELDSET>
		</DIV>
	</DIV>

	<SCRIPT>
		function saveOptions() {
			return {
				'service':   $("#radioyahoo").is(':checked') ? 'yahoo' : $("#radioopen").is(':checked') ? 'open' : 'wundr',
				'color':     $("#radioduke").is(':checked') ? 'duke' : $("#radioblack").is(':checked') ? 'black' : 'red',
				'scale':     $("#radioF").is(':checked')     ? 'F' : 'C',
				'battery':   $("select[name=flipbattery]").prop('selectedIndex') ? 'on' : 'off',
				'bluetooth': $("select[name=flipbluetooth]").prop('selectedIndex') ? 'on' : 'off',
				'timesig':   $("select[name=fliptimesignal]").prop('selectedIndex') ? 'on' : 'off',
				'tsstart':   $("select[name=fliptimesignal]").prop('selectedIndex') ? $("select[name=vibstart]").val() :  '7',
				'tsend':     $("select[name=fliptimesignal]").prop('selectedIndex') ? $("select[name=vibend]").val()   : '22',
				'debug':     $("select[name=flipdebug]").prop('selectedIndex')   ? 'true' : 'false',
				'wuApiKey':  $("select[name=fliphourly]").prop('selectedIndex')  ? $("#text-apikey").val() : null
			};
		}

		function getURLParameter(name) {
			return decodeURI(
				(RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
			);
		}

		// Get query variables
		function getQueryParam(variable, defaultValue) {
			// Find all URL parameters
			var query = location.search.substring(1);
			var vars = query.split('&');
			for (var i = 0; i < vars.length; i++) {
				var pair = vars[i].split('=');

				// If the query variable parameter is found, decode it to use and return it for use
				if (pair[0] === variable) {
					return decodeURIComponent(pair[1]);
				}
			}
			return defaultValue || false;
		}


		$().ready(function() {

			var initialLoad = true;

			var flipHourly = $("select[name=fliphourly]");

			flipHourly.bind( "change", function(event, ui) {

				var val = $(this).val();

				if (val === 'on') {
					$("#apikey").show();
					if (!initialLoad) {
						$("#popupCloseRight").popup("open");
					}
				} else {
					$("#apikey").hide();
				}
			});

			var service = getURLParameter('s');

			if (service === 'open') {
				$("#radioopen").attr("checked", "checked");
			} else if (service === 'yahoo') {
				$("#radioyahoo").attr("checked", "checked");
			} else {
				$("#radiowundr").attr("checked", "checked");
			}

			$("input[name='weather-service']").checkboxradio("refresh");

			var color = getURLParameter('c');

			if (color === 'duke') {
				$("#radioduke").attr("checked", "checked");
			} else if (color === 'black') {
				$("#radioblack").attr("checked", "checked");
			} else {
				$("#radiored").attr("checked", "checked");
			}

			$("input[name='bg-color']").checkboxradio("refresh");

			var scale = getURLParameter('u');

			if (scale === 'C') {
				$("#radioC").attr("checked", "checked");
			} else {
				$("#radioF").attr("checked", "checked");
			}

			$("input[name='weather-scale']").checkboxradio("refresh");

			var apikey = getURLParameter('a');

			if (apikey !== 'null') {
				flipHourly.prop('selectedIndex', 1);
				$("#text-apikey").val(apikey);
			} else {
				flipHourly.prop('selectedIndex', 0);
			}

			flipHourly.change();

			var flipBattery = $("select[name=flipbattery]");
			var battery = getURLParameter('b');

			if (battery === 'off') {
				flipBattery.prop('selectedIndex', 0);
			} else {
				flipBattery.prop('selectedIndex', 1);
			}

			var flipBluetooth = $("select[name=flipbluetooth]");
			var bluetooth = getURLParameter('t');

			if (bluetooth === 'off') {
				flipBluetooth.prop('selectedIndex', 0);
			} else {
				flipBluetooth.prop('selectedIndex', 1);
			}

			var flipTimesignal = $("select[name=fliptimesignal]");
			var timesig = getURLParameter('v');

			if (timesig === 'off') {
				flipTimesignal.prop('selectedIndex', 0);
			} else {
				flipTimesignal.prop('selectedIndex', 1);
			}

			var flipVibStart = $("select[name=vibstart]");
			var tsstart = getURLParameter('f');

			if (tsstart >= 0 && tsstart <= 23) {
				flipVibStart.val(tsstart);
			} else {
				flipVibStart.val('7');
			}

			$("select[name='vibstart']").selectmenu("refresh");

			var flipVibEnd = $("select[name=vibend]");
			var tsend = getURLParameter('e');

			if (tsend >= 0 && tsend <= 23) {
				flipVibEnd.val(tsend);
			} else {
				flipVibEnd.val('22');
			}

			$("select[name='vibend']").selectmenu("refresh");

			var flipDebug = $("select[name=flipdebug]");
			var debug = getURLParameter('d');

			if (debug === 'true') {
				flipDebug.prop('selectedIndex', 1);
			} else {
				flipDebug.prop('selectedIndex', 0);
			}

			$("select").slider("refresh");

			$("#b-cancel").click(function() {
				console.log("Cancel");
				document.location = "pebblejs://close";
			});

			$("#b-submit").click(function() {
				console.log("Submit");

				var returnTo = getQueryParam('return_to', 'pebblejs://close#');
				var location = returnTo + encodeURIComponent(JSON.stringify(saveOptions()));
				console.log("Warping to: " + location);
				console.log(location);
				document.location = location;
			});

			initialLoad = false;
		});
	</SCRIPT>

 </BODY>

</HTML>
